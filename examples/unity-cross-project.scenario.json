{
  "schema_version": "2.0.0",
  "scenario_id": "unity-tail-adjust-cross-project",
  "name": "Unity Tail Adjust Cross Project",
  "description": "Reusable Unity hierarchy flow that can run against multiple avatar projects via variables.",
  "target": "unity",
  "tags": [
    "unity",
    "variable-first",
    "cross-project"
  ],
  "variables": [
    {
      "id": "unity_project_path",
      "title": "Unity Project Path",
      "type": "path",
      "required": true,
      "bindings": {
        "env": "UNITY_PROJECT_PATH",
        "cli_arg": "--unity-project-path",
        "profile_key": "unity_project_path"
      }
    },
    {
      "id": "unity_window_hint",
      "title": "Unity Window Hint",
      "type": "string",
      "required": false,
      "default": "Unity"
    },
    {
      "id": "avatar_root",
      "title": "Avatar Root Hierarchy Path",
      "type": "string",
      "required": true,
      "validation": {
        "min_length": 1
      }
    },
    {
      "id": "target_parts",
      "title": "Target Hierarchy Suffixes",
      "description": "Relative hierarchy paths under avatar_root to be selected in sequence.",
      "type": "json",
      "required": true,
      "default": [
        "BeastParts_Ear_L",
        "BeastParts_Ear_R",
        "BeastParts_Tail"
      ]
    },
    {
      "id": "post_select_shortcut",
      "title": "Shortcut after each selection",
      "type": "string",
      "required": false,
      "default": "CTRL+D"
    }
  ],
  "profiles": {
    "ryuon": {
      "description": "Ryuon project profile",
      "variables": {
        "unity_project_path": "D:/VRChatProjects/Ryuon",
        "avatar_root": "Ryuon_ComeBody_Human",
        "target_parts": [
          "Hair_Parts",
          "BeastParts_Tail",
          "ComeBody_Armature"
        ]
      }
    },
    "sample-avatar": {
      "description": "Sample avatar profile",
      "variables": {
        "unity_project_path": "D:/VRChatProjects/SampleAvatar",
        "avatar_root": "SampleAvatarRoot",
        "target_parts": [
          "Ear_L",
          "Ear_R",
          "Tail"
        ]
      }
    }
  },
  "execution": {
    "mode": "attach",
    "default_timeout_seconds": 30,
    "default_poll_interval_seconds": 0.5,
    "default_retry": {
      "attempts": 3,
      "interval_seconds": 1,
      "on": [
        "timeout",
        "not_found"
      ]
    },
    "attach": {
      "window_hint_var": "unity_window_hint",
      "require_visible_window": true
    },
    "launch": {
      "unity_project_path_var": "unity_project_path",
      "create_project_if_missing": false
    }
  },
  "outputs": {
    "markdown": {
      "enabled": true,
      "locale": "ja-JP",
      "include_step_data": false
    },
    "screenshots": {
      "enabled": true,
      "format": "png",
      "capture_before_action": false,
      "capture_after_action": true
    },
    "video": {
      "enabled": true,
      "fps": 30,
      "codec": "h264",
      "include_annotations": true
    },
    "trace": {
      "enabled": true,
      "level": "standard",
      "include_variables": false
    }
  },
  "steps": [
    {
      "id": "ensure-unity-window",
      "title": "Ensure Unity window is targetable",
      "kind": "action",
      "action": "wait_for",
      "target": {
        "strategy": "uia",
        "uia": {
          "title": "${unity_window_hint}"
        }
      },
      "timing": {
        "timeout_seconds": 30,
        "poll_interval_seconds": 0.5
      }
    },
    {
      "id": "iterate-target-parts",
      "title": "Select each target hierarchy object",
      "kind": "control",
      "control": "for_each",
      "items_expression": "${target_parts}",
      "item_variable": "part_path",
      "steps": [
        {
          "id": "select-hierarchy-item",
          "title": "Select hierarchy item",
          "kind": "action",
          "action": "select_hierarchy",
          "target": {
            "strategy": "unity_hierarchy",
            "unity_hierarchy": {
              "path": "${avatar_root}/${part_path}",
              "match_mode": "exact"
            }
          },
          "retry": {
            "attempts": 45,
            "interval_seconds": 1,
            "on": [
              "timeout",
              "not_found"
            ]
          },
          "annotations": [
            {
              "type": "number_badge",
              "text": "${part_path}"
            }
          ]
        },
        {
          "id": "emit-click-pulse",
          "title": "Emit click pulse annotation",
          "kind": "action",
          "action": "emit_annotation",
          "annotations": [
            {
              "type": "click_pulse",
              "style": {
                "color": "#ff3b30",
                "duration_ms": 600
              }
            }
          ]
        }
      ]
    },
    {
      "id": "duplicate-selection",
      "title": "Run configured shortcut",
      "kind": "action",
      "action": "press_keys",
      "input": {
        "shortcut": "${post_select_shortcut}"
      }
    }
  ]
}
